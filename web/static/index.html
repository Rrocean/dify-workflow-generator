<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dify Workflow Generator - World Class Workflow Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .node-card {
            transition: all 0.3s ease;
        }
        .node-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Navigation -->
        <nav class="gradient-bg text-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center">
                        <span class="text-2xl font-bold">üöÄ Dify Workflow Generator</span>
                        <span class="ml-4 px-3 py-1 bg-white/20 rounded-full text-sm">World Class Edition</span>
                    </div>
                    <div class="flex space-x-4">
                        <button @click="currentView = 'dashboard'" 
                                :class="{'bg-white/20': currentView === 'dashboard'}"
                                class="px-4 py-2 rounded-lg hover:bg-white/10 transition">
                            Dashboard
                        </button>
                        <button @click="currentView = 'workflows'"
                                :class="{'bg-white/20': currentView === 'workflows'}"
                                class="px-4 py-2 rounded-lg hover:bg-white/10 transition">
                            Workflows
                        </button>
                        <button @click="currentView = 'templates'"
                                :class="{'bg-white/20': currentView === 'templates'}"
                                class="px-4 py-2 rounded-lg hover:bg-white/10 transition">
                            Templates
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard View -->
            <div v-if="currentView === 'dashboard'" class="animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="text-3xl font-bold text-indigo-600">{{ stats.totalWorkflows }}</div>
                        <div class="text-gray-500">Total Workflows</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="text-3xl font-bold text-green-600">{{ stats.totalNodes }}</div>
                        <div class="text-gray-500">Total Nodes</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="text-3xl font-bold text-purple-600">{{ stats.avgOptimizationScore }}</div>
                        <div class="text-gray-500">Avg Optimization Score</div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="text-3xl font-bold text-orange-600">{{ stats.templatesCount }}</div>
                        <div class="text-gray-500">Templates</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Recent Workflows -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-4">Recent Workflows</h2>
                        <div v-if="workflows.length === 0" class="text-gray-400 text-center py-8">
                            No workflows yet. Create your first one!
                        </div>
                        <div v-else class="space-y-3">
                            <div v-for="wf in workflows.slice(0, 5)" :key="wf.id" 
                                 class="p-4 border rounded-lg hover:shadow-md transition cursor-pointer"
                                 @click="viewWorkflow(wf.id)">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold">{{ wf.name }}</div>
                                        <div class="text-sm text-gray-500">{{ wf.mode }} ‚Ä¢ {{ wf.node_count }} nodes</div>
                                    </div>
                                    <span class="px-2 py-1 bg-indigo-100 text-indigo-600 rounded text-sm">
                                        {{ wf.version }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold mb-4">Quick Actions</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <button @click="showCreateModal = true"
                                    class="p-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                                <div class="text-2xl mb-2">‚ûï</div>
                                <div class="font-semibold">Create Workflow</div>
                            </button>
                            <button @click="currentView = 'templates'"
                                    class="p-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                                <div class="text-2xl mb-2">üìã</div>
                                <div class="font-semibold">From Template</div>
                            </button>
                            <button class="p-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                                <div class="text-2xl mb-2">üìä</div>
                                <div class="font-semibold">Import Workflow</div>
                            </button>
                            <button class="p-4 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                                <div class="text-2xl mb-2">üìñ</div>
                                <div class="font-semibold">Documentation</div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workflows View -->
            <div v-if="currentView === 'workflows'" class="animate-fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-3xl font-bold">All Workflows</h1>
                    <button @click="showCreateModal = true"
                            class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        + Create New Workflow
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mode</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nodes</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Created</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr v-for="wf in workflows" :key="wf.id" class="hover:bg-gray-50">
                                <td class="px-6 py-4">
                                    <div class="font-semibold">{{ wf.name }}</div>
                                    <div class="text-sm text-gray-500">{{ wf.description }}</div>
                                </td>
                                <td class="px-6 py-4">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                                        {{ wf.mode }}
                                    </span>
                                </td>
                                <td class="px-6 py-4">{{ wf.node_count }}</td>
                                <td class="px-6 py-4 text-sm text-gray-500">{{ formatDate(wf.created_at) }}</td>
                                <td class="px-6 py-4 text-right space-x-2">
                                    <button @click="viewWorkflow(wf.id)" class="text-indigo-600 hover:text-indigo-900">View</button>
                                    <button @click="exportWorkflow(wf.id)" class="text-green-600 hover:text-green-900">Export</button>
                                    <button @click="deleteWorkflow(wf.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Templates View -->
            <div v-if="currentView === 'templates'" class="animate-fade-in">
                <h1 class="text-3xl font-bold mb-6">Workflow Templates</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="template in templates" :key="template.id"
                         class="bg-white rounded-xl shadow-lg p-6 node-card cursor-pointer"
                         @click="createFromTemplate(template.id)">
                        <div class="flex items-center mb-4">
                            <span class="text-3xl mr-3">
                                {{ getTemplateIcon(template.category) }}
                            </span>
                            <div>
                                <h3 class="font-bold text-lg">{{ template.name }}</h3>
                                <span class="text-sm text-gray-500">{{ template.category }}</span>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-4">{{ template.description }}</p>
                        <button class="w-full py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                            Use Template
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Create Workflow Modal -->
        <div v-if="showCreateModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold mb-4">Create New Workflow</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input v-model="newWorkflow.name" type="text" 
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                               placeholder="My Workflow">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mode</label>
                        <select v-model="newWorkflow.mode" 
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="workflow">Workflow</option>
                            <option value="advanced-chat">Advanced Chat</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea v-model="newWorkflow.description" 
                                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                                  rows="3"></textarea>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button @click="showCreateModal = false"
                            class="px-4 py-2 border rounded-lg hover:bg-gray-50 transition">
                        Cancel
                    </button>
                    <button @click="createWorkflow"
                            class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                        Create
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notifications -->
        <div class="fixed bottom-4 right-4 space-y-2">
            <div v-for="toast in toasts" :key="toast.id"
                 :class="{
                     'bg-green-500': toast.type === 'success',
                     'bg-red-500': toast.type === 'error',
                     'bg-blue-500': toast.type === 'info'
                 }"
                 class="text-white px-6 py-3 rounded-lg shadow-lg animate-fade-in">
                {{ toast.message }}
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'dashboard',
                    workflows: [],
                    templates: [],
                    stats: {
                        totalWorkflows: 0,
                        totalNodes: 0,
                        avgOptimizationScore: 0,
                        templatesCount: 0
                    },
                    showCreateModal: false,
                    newWorkflow: {
                        name: '',
                        mode: 'workflow',
                        description: ''
                    },
                    toasts: []
                }
            },
            async mounted() {
                await this.loadData();
            },
            methods: {
                async loadData() {
                    try {
                        // Load workflows
                        const wfResponse = await axios.get('/api/workflows');
                        this.workflows = wfResponse.data;
                        this.stats.totalWorkflows = this.workflows.length;
                        this.stats.totalNodes = this.workflows.reduce((sum, wf) => sum + wf.node_count, 0);

                        // Load templates
                        const tplResponse = await axios.get('/api/templates');
                        this.templates = tplResponse.data;
                        this.stats.templatesCount = this.templates.length;
                    } catch (error) {
                        this.showToast('Error loading data', 'error');
                    }
                },
                async createWorkflow() {
                    try {
                        const response = await axios.post('/api/workflows', this.newWorkflow);
                        this.showToast('Workflow created successfully!', 'success');
                        this.showCreateModal = false;
                        this.newWorkflow = { name: '', mode: 'workflow', description: '' };
                        await this.loadData();
                    } catch (error) {
                        this.showToast('Error creating workflow', 'error');
                    }
                },
                async createFromTemplate(templateId) {
                    try {
                        const response = await axios.post(`/api/templates/${templateId}/create`);
                        this.showToast('Workflow created from template!', 'success');
                        await this.loadData();
                        this.currentView = 'workflows';
                    } catch (error) {
                        this.showToast('Error creating from template', 'error');
                    }
                },
                async deleteWorkflow(id) {
                    if (!confirm('Are you sure you want to delete this workflow?')) return;
                    try {
                        await axios.delete(`/api/workflows/${id}`);
                        this.showToast('Workflow deleted', 'success');
                        await this.loadData();
                    } catch (error) {
                        this.showToast('Error deleting workflow', 'error');
                    }
                },
                async exportWorkflow(id) {
                    try {
                        const response = await axios.post(`/api/workflows/${id}/export`);
                        this.showToast('Workflow exported!', 'success');
                    } catch (error) {
                        this.showToast('Error exporting workflow', 'error');
                    }
                },
                viewWorkflow(id) {
                    this.showToast('View workflow: ' + id, 'info');
                },
                showToast(message, type = 'info') {
                    const id = Date.now();
                    this.toasts.push({ id, message, type });
                    setTimeout(() => {
                        this.toasts = this.toasts.filter(t => t.id !== id);
                    }, 3000);
                },
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString();
                },
                getTemplateIcon(category) {
                    const icons = {
                        'chat': 'üí¨',
                        'nlp': 'üß†',
                        'content': '‚úçÔ∏è',
                        'developer': 'üë®‚Äçüíª',
                        'productivity': '‚ö°'
                    };
                    return icons[category] || 'üì¶';
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
